<?php
require_once("template/header.phtml");
?>
<div id = "myGroup" class = "container">
    <div class = "row justify-content-center">
        <h2>Here you can mark a candidate</h2>
    </div>
        <?php
            if(!empty($_COOKIE["candNameAssessor"]))
            {
                echo '<div class = "d-none">';
            }
            else
            {
                echo '<div>';
            }
        ?>
        <form class="form-group" method = "post" action="../assessorView.php">
            <label>Please enter candidate's name to search through all candidates</label>
            <input class="form-control" type="text" name = "candNameAssessor" placeholder="Please Enter candidate name">
            <button type="submit" name = "search" class="btn btn-primary">Search</button>
        </form>
    </div>
        <?php
        if(isset($_COOKIE["candNameAssessor"]) and !isset($_COOKIE["selectedAssessmentType"]))
        {
            if(!empty($_COOKIE["candNameAssessor"]))
            {
                echo '<div>';
            }
            else
            {
                echo '<div class = "d-none">';
            }
        }
        else
        {
            echo '<div class = "d-none">';
        }
        ?>
        <form class="form-group" method = "post" action="../assessorView.php">
            <label> Assessment Types For candidate:</label>
            <select name = "assessmentTypes" multiple class="form-control">
                <?php
                foreach($_SESSION["assessmentTypeNames"] as $currentType)
                {
                    echo '<option>'.$currentType. '</option>';
                }
                ?>
            </select>
            <button type="submit" name = "selectedAssessmentType" class="btn btn-primary">Select Assessment Type</button>
        </form>
    </div>
    <?php
    if(isset($_COOKIE["selectedAssessmentType"]))
    {
        if(!empty($_COOKIE["selectedAssessmentType"]))
        {
            echo '<div>';
        }
        else
        {
            echo '<div class = "d-none">';
        }
    }
    else
    {
        echo '<div class = "d-none">';
    }
    ?>


    <?php
    $function = new assessorViewFunctions();
    $sectionNo = 0;
    $sectionIDsArray = array();
    foreach($_SESSION['sectionIDs'] as $currentSectionID)
    {
        array_push($sectionIDsArray,$currentSectionID);
    }
    foreach($_SESSION['sectionIDs'] as $currentSectionID)
    {
        $sectionQuery = new SectionQueries();

        $sectionName = $sectionQuery->getSectionNameByID($currentSectionID);
        $sectionDesc = $sectionQuery->getSectionDescByID($currentSectionID);
        $allQuestions = $function->getAllQuestionsWithSections();
        $maxSections = $function->getAllSectionsCount();

        if((int)$_COOKIE["currentPagePerSecID"] == $currentSectionID)
        {
            echo '<form id = "'.$currentSectionID.'" name = "'.$currentSectionID.'" class="form-group" method = "post" action="../assessorView.php">';
            echo '<input type="hidden" name = "sectionID" value = "'.$currentSectionID.'">';
            echo '<div id = "section'.$currentSectionID.'">';
            echo '<h2>'.$sectionName[0].'</h2>';
            echo '<h3><i>'.$sectionDesc[0].'</i></h3>';
            $function->getQuestionForSection($allQuestions, $currentSectionID, $sectionNo);
            $currentCount = 0;
            $sectionNo++;
            $currentSectionIDPosition = array_search($currentSectionID, $sectionIDsArray);
            echo '<label>Enter here any feedback you have for this section: </label>
                   <textarea name = "feedbackForSect'.$currentSectionID.'" class="form-control" rows="3"></textarea>';
            echo '</div>';
            if(isset($_COOKIE["letMeSubmit"]))
            {
                if($_COOKIE["letMeSubmit"] === "true")
                {
                    echo '<button type="submit" name = "sectionFinished" class="btn btn-primary float-right">Section Finished!</button>';
                }
            }

            if($currentSectionIDPosition === 0 and isset($sectionIDsArray[$currentSectionIDPosition-1]))
            {
                $sectionNumber = $currentSectionIDPosition+1;
                echo '<div class = "row justify-content-center">Section '.$sectionNumber.' of '.$maxSections.'</div>';
                $nextSectionID = next($_SESSION["sectionIDs"]);
                echo '<a href="../assessorView.php?sectionID='.$nextSectionID.'" class="btn btn-primary">Next<button type = "submit">lol</button></a>';
                $currentSectionID = prev($_SESSION["sectionIDs"]);
            }
            else
            {
                $sectionNumber = $currentSectionIDPosition+1;
                echo '<div class = "row justify-content-center">Section '.$sectionNumber.' of '.$maxSections.'</div>';


                if(isset($sectionIDsArray[$currentSectionIDPosition-1]))
                {
                    $previousSectionID = $sectionIDsArray[$currentSectionIDPosition-1];
                    echo '<a href="../assessorView.php?sectionID='.$previousSectionID.'" class="btn btn-primary">Back</a>';
                }

                if(isset($sectionIDsArray[$currentSectionIDPosition+1]))
                {
                    $nextSectionID = $sectionIDsArray[$currentSectionIDPosition+1];
                    echo '<a href="../assessorView.php?sectionID='.$nextSectionID.'" class="btn btn-primary">Next</a>';
                }
            }
            echo '</form>';

            #if($sectionNo == 1)
            #{
            #    $numberOfsecIDs = count($_SESSION["sectionIDs"]);
            #    for($x = 0; $x < $numberOfsecIDs; $x++)
            #    {
            #        $currentSectionIDSession = current($_SESSION["sectionIDs"]);
            #        if($currentSectionID !== $currentSectionIDSession)
            #        {
            #            $currentSectionIDSession = next($_SESSION["sectionIDs"]);
            #        }
            #        if($currentSectionID === $currentSectionIDSession)
            #        {
            #            $nextSectionID = next($_SESSION["sectionIDs"]);
            #            if(!empty($nextSectionID))
            #            {
            #                echo '<a href="../assessorView.php?sectionID='.$nextSectionID.'" class="btn btn-primary">Next</a>';
            #                $nextSectionID = prev($_SESSION["sectionIDs"]);
            #                //echo '<div class = "row justify-content-center">Section no: '.$sectionNo.'/'.$numberOfsecIDs.'</div>';
            #            }
            #            if(!$nextSectionID)
            #            {
            #               $nextSectionID = prev($_SESSION["sectionIDs"]);
            #            }
            #            $prevSectionID = prev($_SESSION["sectionIDs"]);
            #            if(!empty($prevSectionID))
            #            {
            #                echo '<a href="../assessorView.php?sectionID='.$prevSectionID.'" class="btn btn-primary">Back</a>';
            #                if(!empty(next($_SESSION["sectionIDs"])))
            #                {
            #                    $nextSectionID = next($_SESSION["sectionIDs"]);
            #                    echo '<a href="../assessorView.php?sectionID='.$nextSectionID.'" class="btn btn-primary">Next</a>';
#
            #                }
            #            }
            #            echo '<div class = "row justify-content-center">Section no: '.$sectionNo.'/'.$numberOfsecIDs.'</div>';
#
            #        }
            #    }
            #}

        }
    }
    ?>
    </div>

<a href="../deleteCookies.php" class="btn btn-primary">Delete Cookies</a>
</div>
<?php require_once("template/footer.phtml"); ?>
